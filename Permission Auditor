import os
import stat # Provides constants for interpreting file permissions
from datetime import datetime

def permission_auditor(directory):
    print(f"\n{'='*60}")
    print(f"SECURITY PERMISSION AUDIT: {directory}")
    print(f" Date: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print(f"{'='*60}\n")

    # Check if the path exists
    if not os.path.exists(directory):
        print(" Error: Directory not found!")
        return

    # List all entries in the folder
    entries = os.listdir(directory)
    
    for entry in entries:
        path = os.path.join(directory, entry)
        
        # We only audit files for now
        if os.path.isfile(path):
            # Get file status information
            file_stats = os.stat(path)
            mode = file_stats.st_mode # Contains permission bits
            
            # Check Read, Write, and Execute permissions
            is_readable = os.access(path, os.R_OK)
            is_writable = os.access(path, os.W_OK)
            is_executable = os.access(path, os.X_OK)

            # Security Risk Logic
            risk_level = "SECURE"
            if is_writable:
                risk_level = " VULNERABLE (Write Access Open)"
            if is_executable:
                risk_level = " CRITICAL (Script/Executable File)"

            print(f" File: {entry}")
            print(f"   |-- Readable  : {is_readable}")
            print(f"   |-- Writable  : {is_writable}")
            print(f"   |-- Executable: {is_executable}")
            print(f"   |-- Risk Level: {risk_level}")
            print(f"{'-'*40}")

if __name__ == "__main__":
    # You can change '.' to any folder path like 'C:/Users/Downloads'
    permission_auditor('.')